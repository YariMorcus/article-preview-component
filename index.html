<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="An article preview component made by Yari Morcus. A challenge from Frontend Mentor">
    <meta name="keywords" content="frontendmentor frontend yarimorcus yari morcus coding challenge article preview component">
    <meta name="author" content="Yari Morcus">

    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="canonical" href="https://yarimorcus.github.io/article-preview-component">

    <!-- custom CSS -->
    <link rel="stylesheet" href="css/main.css">

    <title>Article preview component | Frontend Mentor challenge</title>

</head>
<body>

    <main>

        <article class="article-preview">

            <div class="article-preview__header-img"></div>

            <div class="article-preview__content">
                <header class="article-preview__header">
                    <h2 class="article-preview__title">Shift the overall look and feel by adding these wonderful touches to furniture in your home</h2>
                    <p class="article-preview__paragraph">Ever been in a room and felt like something was missing? Perhaps it felt slightly bare and uninviting. Iâ€™ve got some simple tips to help you make any room feel complete.</p>
                </header> <!-- .article-preview__header -->

                <footer class="article-preview__footer">
                    <img src="img/avatar-michelle.webp" alt="" class="article-preview__author-img" height="40">
                    <div class="article-preview__author-info">
                        <p class="article-preview__author-name">Michelle Appleton</p>
                        <time class="article-preview__publish-date" datetime="2020-06-28">28 Jun 2020</time>
                    </div> <!-- .article-preview__author-container -->
                    <div class="article-preview__share-button-container">
                        <button class="article-preview__share-button" aria-label="Share"></button>
                    </div>
                </footer> <!-- .article-preview__footer -->

            </div> <!-- .article-preview__content -->

        </article> <!-- .article-preview -->

    </main>

    <footer class="footer">
        Challenge by <a class="footer__link" href="https://www.frontendmentor.io?ref=challenge" target="_blank">Frontend Mentor</a>.
        Coded&nbsp;by&nbsp;<a class="footer__link" href="https://www.linkedin.com/in/yarimorcus" target="_blank">Yari&nbsp;Morcus</a>.
    </footer> <!-- .footer -->

    <script>

        const SHARE_BUTTONS = document.querySelectorAll( '.article-preview__share-button' );

        function removeActiveClass(activeShareButton) {
            activeShareButton.classList.remove( activeShareButton.classList[1] );

        }

        function createShareContainer(e) {

            // Helper function
            function setAttributes(el, attrs) {
                for (const attr in attrs) {
                    el.setAttribute(attr, attrs[attr])
                }
            }

            const SHARE_BUTTON = e.currentTarget;

            const ARTICLE_PREVIEW_FOOTER = document.querySelector( '.article-preview__footer' );

            const SHARE_BUTTON_CONTAINER = e.target.parentNode;

            // Setup share container (parent)
            const SHARE_CONTAINER = document.createElement( 'div' );
            SHARE_CONTAINER.classList.add( 'article-preview__share-container' );

            // Setup share options container
            const SHARE_OPTIONS_CONTAINER = document.createElement( 'div' );
            SHARE_OPTIONS_CONTAINER.classList.add( 'article-preview__share-options' );

            // Setup 'SHARE' text
            const SHARE_TEXT_SPAN = document.createElement( 'span' );
            SHARE_TEXT_SPAN.classList.add( 'article-preview__share-text' );
            const SHARE_TEXT = document.createTextNode( 'share' );
            SHARE_TEXT_SPAN.appendChild( SHARE_TEXT );

            // Setup Facebook anchor
            const ANCHOR_FB = document.createElement( 'a' );
            ANCHOR_FB.classList.add( 'article-preview__share-fb' );
            setAttributes( ANCHOR_FB, { 'href': '#', 'rel': 'noopener noreferrer' } );

            const ANCHOR_FB_SVG = document.createElement( 'img' );
            setAttributes( ANCHOR_FB_SVG, { 'src': 'img/icon-facebook.svg', 'alt': 'Share on Facebook', 'width': '20', 'height': '20' } );

            ANCHOR_FB.appendChild( ANCHOR_FB_SVG );

            // Setup Twitter anchor
            const ANCHOR_TWT = document.createElement( 'a' );
            ANCHOR_TWT.classList.add( 'article-preview__share-twt' );
            setAttributes( ANCHOR_TWT, { 'href': '#', 'rel': 'noopener noreferrer' } );

            const ANCHOR_TWT_SVG = document.createElement( 'img' );
            setAttributes( ANCHOR_TWT_SVG, { 'src': 'img/icon-twitter.svg', 'alt': 'Share on Twitter', 'width': '20', 'height': '20' } );

            ANCHOR_TWT.appendChild( ANCHOR_TWT_SVG );

            // Setup Pinterest anchor
            const ANCHOR_PIN = document.createElement( 'a' );
            ANCHOR_PIN.classList.add( 'article-preview__share-pin' );
            setAttributes( ANCHOR_PIN, { 'href': '#', 'rel': 'noopener noreferrer' } );

            const ANCHOR_PIN_SVG = document.createElement( 'img' );
            setAttributes( ANCHOR_PIN_SVG, { 'src': 'img/icon-pinterest.svg', 'alt': 'Share on Pinterest', 'width': '20', 'height': '20' } );
            ANCHOR_PIN.appendChild( ANCHOR_PIN_SVG );

            // Append share text and all options to share options container
            SHARE_OPTIONS_CONTAINER.append( SHARE_TEXT_SPAN, ANCHOR_FB, ANCHOR_TWT, ANCHOR_PIN );

            // Setup share icon
            const SHARE_BUTTON_POPOVER = document.createElement( 'button' );
            SHARE_BUTTON_POPOVER.classList.add( 'article-preview__share-button-popover' );

            // Append all nodes to parent container
            SHARE_CONTAINER.append( SHARE_OPTIONS_CONTAINER, SHARE_BUTTON_POPOVER );

            // Append share container to .article-preview__share-button-container
            SHARE_BUTTON_CONTAINER.appendChild( SHARE_CONTAINER );

            SHARE_BUTTON.classList.add( `${SHARE_BUTTON.className}--selected` );

            const mql = window.matchMedia( '(min-width: 768px)' );

            ANCHOR_PIN.addEventListener( 'blur', (e) => {
                // Change focus order based on viewport width (otherwise this results in a wrong tab order)
                if (mql.matches) {
                    // console.log(e.target);
                    SHARE_BUTTON.focus();
                } else {
                    SHARE_BUTTON_POPOVER.focus();
                }
            } );

            // Remove event listener otherwise share container will be deleted and created immediately
            // Results in container not being deleted
            SHARE_BUTTON.removeEventListener('click', createShareContainer );

            SHARE_BUTTON.addEventListener( 'click', () => {
                SHARE_CONTAINER.remove();
                SHARE_BUTTON.classList.remove( 'article-preview__share-button-popover' );
            } );

            SHARE_BUTTON_POPOVER.addEventListener( 'click', () => {
                SHARE_CONTAINER.remove();
                SHARE_BUTTON.focus();
                removeActiveClass(SHARE_BUTTON);
            } );
        }

        [...SHARE_BUTTONS].forEach( (SHARE_BUTTON) => {
            SHARE_BUTTON.addEventListener( 'click', e => {

                // If share container already exists, remove it (otherwise it is recreated immediately).
                if ( e.target.nextElementSibling) {
                    e.target.nextElementSibling.remove();
                    removeActiveClass(SHARE_BUTTON);
                } else {
                    createShareContainer(e);
                }

            } );
        } );

    </script>
</body>
</html>